<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Crypto Prices Banner</title>
<style>
 :root{
  --banner-h:50px;            /* altura */
  --scroll-duration:120s;     /* velocidade */
  --bg:#0e1117;--text:#e6e8ea;--divider:#2c313d;
 }
 html,body{margin:0;padding:0;background:transparent;font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",Helvetica,Arial,sans-serif;}
 #cryptoBanner{position:absolute;inset:0 auto auto 0;height:var(--banner-h);background:var(--bg);color:var(--text);overflow:hidden;white-space:nowrap;box-shadow:0 3px 8px rgba(0,0,0,.45);}  
 .track{display:flex;height:100%;align-items:center;animation:scroll var(--scroll-duration) linear infinite;will-change:transform;}  
 @keyframes scroll{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}  
 #cryptoBanner:hover .track{animation-play-state:paused;}  
 .item{display:flex;align-items:center;gap:6px;padding:0 12px;border-right:1px solid var(--divider);font-size:13px;font-weight:600;}  
 .item img{height:18px;width:18px;object-fit:contain;}  
 .price{font-variant-numeric:tabular-nums;}  
 .up{color:#00d97e;} .down{color:#ff5c5c;}  
</style>
</head>
<body>
<div id="cryptoBanner"><div class="track" id="track"></div></div>
<script>
/* -------------------------------------------------------
   Crypto banner v17 → v18
   - skip tokens que voltam sem preço numérico (evita erro toLocaleString)
   - usa "–" quando variação ausente
---------------------------------------------------------*/
const COINS=[
  {id:"bitcoin",symbol:"BTC"},
  {id:"ethereum",symbol:"ETH"},
  {id:"solana",symbol:"SOL"},
  {id:"tron",symbol:"TRX"},
  {id:"dogecoin",symbol:"DOGE"},
  {id:"hyperliquid",symbol:"HYPE"},
  {id:"sui",symbol:"SUI"},
  {id:"chainlink",symbol:"LINK"},
  {id:"avalanche-2",symbol:"AVAX"},
  {id:"toncoin",symbol:"TON"},
  {id:"shiba-inu",symbol:"SHIB"},
  {id:"monero",symbol:"XMR"},
  {id:"polkadot",symbol:"DOT"},
  {id:"uniswap",symbol:"UNI"},
  {id:"pepe",symbol:"PEPE"},
  {id:"aave",symbol:"AAVE"},
  {id:"near",symbol:"NEAR"},
  {id:"ondo-finance",symbol:"ONDO"},
  {id:"render-token",symbol:"RNDR"},
  {id:"cosmos",symbol:"ATOM"},
  {id:"arbitrum",symbol:"ARB"},
  {id:"jupiter",symbol:"JUP"},
  {id:"celestia",symbol:"TIA"},
  {id:"fartcoin",symbol:"FART"},
  {id:"sei-network",symbol:"SEI"},
  {id:"stacks",symbol:"STX"},
  {id:"dogwifhat",symbol:"WIF"},
  {id:"jito-governance-token",symbol:"JTO"},
  {id:"lido-dao",symbol:"LDO"},
  {id:"pendle",symbol:"PENDLE"},
  {id:"eigenlayer",symbol:"EIGEN"},
  {id:"etherfi",symbol:"ETHERFI"},
  {id:"popcat",symbol:"POPCAT"},
  {id:"layerzero",symbol:"ZRO"},
  {id:"virtuals-protocol",symbol:"VIRTUAL"}
];

const CHUNK=20;             // máx ids por chamada
const REFRESH_MS=60000;     // 1 minuto
const fmt=n=>typeof n==="number"?n.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):"–";
const icon=s=>`https://raw.githubusercontent.com/spothq/cryptocurrency-icons/master/32/color/${s.toLowerCase()}.png`;

async function fetchChunk(ids){
  const url=`https://api.coingecko.com/api/v3/simple/price?vs_currencies=usd&ids=${ids}&include_24hr_change=true`;
  const r=await fetch(url);
  if(!r.ok) throw new Error(r.status);
  const j=await r.json();
  if(j.error){console.warn(j.error);return {}};
  return j;
}

async function load(){
  try{
    let results={};
    for(let i=0;i<COINS.length;i+=CHUNK){
      if(i) await new Promise(r=>setTimeout(r,1200));
      const slice=COINS.slice(i,i+CHUNK);
      const json=await fetchChunk(slice.map(c=>c.id).join(","));
      Object.assign(results,json);
    }

    const html=COINS.map(c=>{
      const p=results[c.id];
      if(!p||typeof p.usd!=="number") return ""; // ignora sem preço
      const change=p.usd_24h_change;
      const cls=(typeof change==="number"&&change>=0)?"up":"down";
      const sign=(typeof change==="number"&&change>=0?"+":"");
      const changeStr=(typeof change==="number"?`${sign}${fmt(change)}%`:"–");
      return `<div class="item"><img src="${icon(c.symbol)}" onerror="this.remove()"/> <b>${c.symbol}</b> $${fmt(p.usd)} <span class="${cls}">${changeStr}</span></div>`;
    }).filter(Boolean).join("");

    if(!html) throw new Error("Sem dados úteis");
    const track=document.getElementById("track");
    track.innerHTML=html+html;
  }catch(err){
    console.error(err);
    document.getElementById("cryptoBanner").textContent="⚠️ erro ao carregar preços";
  }
}

load();
setInterval(load,REFRESH_MS);
</script>
</body>
</html>
